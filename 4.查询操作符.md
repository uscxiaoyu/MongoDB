### 逻辑操作符

|操作|格式|范例|SQL|
|--:|--:|--:|--:|
|$and |{$and:[{expr1}, {expr2}, ... {exprN}] |db.inventory.find({$and:[{price:1.99}, {sale:true}]}) |where price=1.99 AND sale=true |
|$or |{$or:[{expr1}, {expr2}, ... {exprN}] |db.inventory.find({$or:[{price:1.99}, {sale:true}]})} |where price=1.99 OR sale=true |
|$not |{$not: {expr}} |db.inventory.find({price:{$not:{$gt:1.99}}}) |where price >= 1.99 and price is null|
|$nor |{$nor:[{expr1}, {expr2}, ... {exprN}]} |db.inventory.find( { $nor: [ { price: 1.99 }, { sale: true } ]  } ) |where (price != 1.99 and sale != true) or (price != 1.99 and sale is null) or (price is null and sale != true)|

<b> $exists </b> 查看文档中是否存在某个field

语法: `{ field: { $exists: <boolean> } }`

> When <boolean> is true, $exists matches **the documents that contain the field, including documents where the field value is null**. If <boolean> is false, the query returns only **the documents that do not contain the field**.
MongoDB $exists does not correspond to SQL operator exists. For SQL exists, refer to the $in operator.

```javascript
> db.inventory.find( { qty: { $exists: true, $nin: [ 5, 15 ] } } )
>
```
This query will select all documents in the inventory collection where the qty field exists and its value does not equal 5 or 15.

注意，$exists仅查看给定键是否存在。如果给定文档的测试键存在，即使其对应值为null，也将返回该文档。

<b> $type </b> 查看域对应的值是否为特定的类型

语法: `{field: {$type: <BSON type>}}` 或则　`{ field: { $type: [ <BSON type1> , <BSON type2>, ... ] } }`

$type selects **the documents where the value of the field is an instance of the specified BSON type(s)**. Querying by data type is useful when dealing with highly unstructured data where data types are not predictable.

<b> $expr </b>

Allows the use of aggregation expressions within the query language. $expr can build query expressions that compare fields from the same document in a $match stage.

语法: `{$expr: { <expression> }}`

示例
```javascript
> { "_id" : 1, "category" : "food", "budget": 400, "spent": 450 }
{ "_id" : 2, "category" : "drinks", "budget": 100, "spent": 150 }
{ "_id" : 3, "category" : "clothes", "budget": 100, "spent": 50 }
{ "_id" : 4, "category" : "misc", "budget": 500, "spent": 300 }
{ "_id" : 5, "category" : "travel", "budget": 200, "spent": 650 }
> db.monthlyBudget.find( { $expr: { $gt: [ "$spent" , "$budget" ] } } )
{ "_id" : 1, "category" : "food", "budget" : 400, "spent" : 450 }
{ "_id" : 2, "category" : "drinks", "budget" : 100, "spent" : 150 }
{ "_id" : 5, "category" : "travel", "budget" : 200, "spent" : 650 }
```
#### 元组查询操作符

<b> $all </b>

The $all operator selects the documents where the value of a field is an array that contains all the specified elements.

语法：`{<field>: { $all: [ <value1> , <value2> ... ] } }` 返回`<field>`中包含所有value的文档。

等价于 `$and` 操作符

`{tags: {$all: ["ssl" , "security"]}}` 和 `{$and: [{tags: "ssl"}, {tags: "security"}]}`等价。
`

<b> `$elemMatch`

The $elemMatch operator matches documents that contain an array field with at least one element that matches all the specified query criteria.

语法：`{<field>: {$elemMatch: {<query1>, <query2>, ...}}}` 返回`<field>`中满足任一query的文档。

```javascript
> db.scores.insertMany([{ _id: 1, results: [ 82, 85, 88 ] }, { _id: 2, results: [ 75, 88, 89 ] }])
{ "acknowledged" : true, "insertedIds" : [ 1, 2 ] }
> db.scores.find({results: {$elemMatch: {$gte: 80, $lt: 85 }}})
{ "_id" : 1, "results" : [ 82, 85, 88 ] }
```

<em> 嵌套</em>

```javascript
> db.survey.insertMany([
{_id: 1, results: [{product: "abc", score: 10}, {product: "xyz", score: 5 }]},
{_id: 2, results: [{product: "abc", score: 8}, {product: "xyz", score: 7}]},
{_id: 3, results: [{product: "abc", score: 7}, {product: "xyz", score: 8 }]}])
{ "acknowledged" : true, "insertedIds" : [ 1, 2, 3 ] }
> db.survey.find(
   { results: { $elemMatch: { product: "xyz", score: { $gte: 8 } } } }
)
{ "_id" : 3, "results" : [ { "product" : "abc", "score" : 7 }, { "product" : "xyz", "score" : 8 } ] }
```

<em> 单条件 </em>

以下查询等价

```javascript
> db.survey.find(
   { results: { $elemMatch: { product: "xyz" } } }
  )
{ "_id" : 1, "results" : [ { "product" : "abc", "score" : 10 }, { "product" : "xyz", "score" : 5 } ] }
{ "_id" : 2, "results" : [ { "product" : "abc", "score" : 8 }, { "product" : "xyz", "score" : 7 } ] }
{ "_id" : 3, "results" : [ { "product" : "abc", "score" : 7 }, { "product" : "xyz", "score" : 8 } ] }
> db.survey.find(
    {'results.product': "xyz"}
  )
{ "_id" : 1, "results" : [ { "product" : "abc", "score" : 10 }, { "product" : "xyz", "score" : 5 } ] }
{ "_id" : 2, "results" : [ { "product" : "abc", "score" : 8 }, { "product" : "xyz", "score" : 7 } ] }
{ "_id" : 3, "results" : [ { "product" : "abc", "score" : 7 }, { "product" : "xyz", "score" : 8 } ] }
```

<b> $size </b>

The $size operator matches any array with the number of elements specified by the argument.

语法: `{field: {$size: value}}` 返回field元素个数问value的文档

```javascript
> db.survey.find({results: {$size:2}})
{ "_id" : 1, "results" : [ { "product" : "abc", "score" : 10 }, { "product" : "xyz", "score" : 5 } ] }
{ "_id" : 2, "results" : [ { "product" : "abc", "score" : 8 }, { "product" : "xyz", "score" : 7 } ] }
{ "_id" : 3, "results" : [ { "product" : "abc", "score" : 7 }, { "product" : "xyz", "score" : 8 } ] }
```
